require "rubygems"

# Add the local gems dir if found within the app root; any dependencies loaded
# hereafter will try to load from the local gems before loading system gems.
if (local_gem_dir = File.join(File.dirname(__FILE__), '..', '..', 'gems')) && $BUNDLE.nil?
  $BUNDLE = true; Gem.clear_paths; Gem.path.unshift(local_gem_dir)
end

require "merb-core"

# this loads all plugins required in your init file so don't add them
# here again, Merb will do it for you
Merb.start_environment(:environment => ENV['MERB_ENV'] || 'development')

namespace :mostfit do
  desc "Generates report of MAS financials for Intellecash"
  task :mas_financials do

    client_ids = [17771, 17774, 17776, 17777, 17779, 17746, 17747, 17748, 17749, 17750, 17775, 17753, 17764, 17768, 17770, 17758, 17760, 17762, 17763, 17765, 17737, 17739, 9451, 9454, 9457, 9455, 9453, 9449, 9448, 9458, 17731, 17732, 17733, 7124, 7120, 7121, 7122, 6239, 7123, 6237, 6245, 6240, 6243, 6249, 6248, 7450, 7449, 7448, 7447, 7454, 7453, 7452, 7455, 7451, 17734, 7291, 17789, 7292, 7295, 7293, 7286, 7289, 7288, 7290, 17790, 7296, 7287, 7302, 7304, 7305, 17798, 17799, 17800, 17801, 17802, 17791, 17792, 17793, 17794, 17795, 186, 183, 184, 185, 7702, 7911, 7908, 7912, 17796, 17797, 17803, 17804, 17805, 17806, 17807, 17808, 17809, 17810, 17811, 17812, 17833, 17834, 17835, 17836, 17837, 17813, 17814, 17815, 17816, 17821, 17826, 17828, 17830, 17831, 17832, 17838, 17840, 17841, 17839, 17842, 17817, 17818, 17819, 17820, 17822, 17823, 17824, 17825, 17827, 17829, 17843, 17844, 17845, 17846, 17847, 17848, 17849, 17850, 17851, 17852, 17853, 17854, 17855, 17856, 17857, 17858, 17859, 17860, 17861, 17862, 17878, 7307, 7312, 7333, 7313, 17879, 7309, 7327, 7325, 17880, 17881, 7341, 17882, 7334, 17883, 17863, 17864, 17865, 17866, 17867, 17868, 17869, 17870, 17871, 17872, 17873, 17874, 17875, 17876, 17877, 17914, 17915, 17916, 17917, 17918, 17884, 17885, 17887, 17888, 17889, 17890, 17893, 17894, 17896, 17897, 17899, 17900, 17901, 17903, 17904, 17920, 17922, 17923, 17924, 17926, 17905, 17907, 17908, 17910, 17911, 17931, 17932, 17933, 17934, 17935, 17936, 17937, 17939, 17940, 17941, 17943, 17944, 17945, 17946, 17947, 17948, 17949, 17950, 17951, 17952, 17953, 6949, 6971, 6960, 17954, 6977, 17955, 17956, 6970, 6954, 17957, 6958, 17958, 6956, 6951, 17987, 17973, 17974, 17978, 17981, 17969, 17970, 17971, 17984, 17972, 17913, 17912, 17909, 17891, 17906, 17886, 17892, 17895, 17902, 17898, 18056, 18061, 18063, 18064, 18065, 18069, 18071, 18072, 18073, 18075, 18077, 18078, 18080, 18081, 18082, 18053, 18054, 18055, 18066, 18067, 18046, 18048, 18049, 18051, 18052, 18006, 18008, 18009, 18060, 18089, 18092, 18095, 18097, 17919, 17921, 17925, 17929, 17930, 17938, 17942, 17959, 17961, 17963, 18042, 18043, 18044, 18045, 18047, 18013, 18014, 18015, 18018, 18019, 18020, 18022, 18023, 18024, 18025, 18026, 18027, 18028, 18029, 18030, 18011, 18021, 7607, 7606, 7608, 7611, 7614, 17960, 17962, 7615, 7612, 7619, 7610, 7613, 17964, 17965, 17966, 7605, 7617, 7618, 17967, 17968, 17569, 17571, 7665, 7669, 7666, 7667, 7668, 7663, 7661, 7664, 7387, 7381, 7384, 7386, 18031, 18033, 7261, 7264, 7266, 18032, 7262, 18035, 18036, 18038, 18039, 190, 640, 17989, 189, 17927, 17991, 17992, 17928, 17994, 7657, 7658, 7655, 7656, 18041, 18068, 18070, 18074, 18076, 18079, 18083, 18084, 18085, 18086, 18088, 18096, 18099, 18100, 17995, 18101, 17999, 18001, 18103, 18007, 18010, 18012, 17975, 17976, 17977, 17979, 17980, 17982, 17983, 17985, 17986, 17988, 18050, 18057, 18058, 18059, 18062, 18087, 18090, 18091, 18093, 18094, 7415, 7418, 7412, 7413, 7416, 7419, 18119, 7414, 7422, 7421, 18124, 7436, 7439, 7437, 7438, 18112, 18113, 18114, 18115, 18116, 18118, 18120, 18121, 18122, 18123, 18125, 18126, 18127, 18128, 18129, 18130, 18131, 18132, 18133, 18134, 18145, 18146, 18147, 18148, 18149, 18016, 18150, 18151, 18152, 18153, 18154, 7359, 7356, 7357, 7358, 7360, 5018, 18155, 18156, 18157, 18158, 18017, 18034, 18037, 18040, 17990, 17993, 17996, 17997, 17998, 18000, 18002, 18003, 18004, 18005, 18161, 18162, 18163, 18098, 18164, 18102, 18166, 18104, 18105, 18106, 18168, 95, 93, 7367, 23, 27, 36, 33, 32, 35, 24, 21, 25, 22, 92, 18107, 18108, 18109, 7516, 18110, 18111, 5167, 7510, 7513, 7517, 8429, 8431, 8430, 8433, 8432, 7848, 7846, 7844, 7852, 7850, 7464, 7463, 7462, 7461, 18169, 18117, 18135, 18136, 18137, 18138, 18139, 18140, 18141, 18142, 18159, 18143, 18144, 18160, 18165, 18167, 18170, 18171, 18172, 18173, 18174, 18175, 18176, 18177, 18178, 18179, 18180, 18181, 18182, 18183, 18184, 18185, 18186, 18187, 18188, 18189, 18190, 18191, 18192, 18193, 18194, 7400, 8791, 7396, 7404, 7403, 8790, 7399, 7408, 7406, 7409, 8793, 18256, 18257, 7397, 7405, 7402, 7407, 8792, 18195, 18205, 18260, 8794, 18207, 18209, 18211, 18212, 18213, 18215, 18216, 18217, 18218, 18219, 18220, 18221, 18222, 18223, 18226, 18230, 18231, 18232, 7629, 7627, 7628, 7625, 7626, 7632, 7634, 18243, 7633, 7624, 7630, 7620, 7623, 7622, 7621, 9358, 9355, 9353, 9361, 18248, 7898, 7897, 7901, 7904, 7905, 7899, 7900, 7902, 7903, 7906, 8352, 8353, 8354, 8351, 18249, 18196, 18197, 18198, 18199, 18200, 18201, 18202, 18203, 18204, 18206, 18208, 18210, 18214, 18293, 18294, 18224, 18225, 18227, 18228, 18229, 18233, 18234, 18235, 18236, 18237, 18238, 18239, 18240, 18241, 18242, 18296, 18297, 18298, 18300, 18301, 18302, 18303, 18304, 18305, 18306, 18250, 18251, 18252, 18253, 18254, 18255, 18258, 18259, 18261, 18262, 18263, 18264, 18265, 18266, 18267, 18323, 18324, 18325, 18326, 18327, 18328, 18329, 18330, 18331, 18332, 18335, 18337, 18339, 18340, 18341, 18342, 18343, 18344, 18345, 18346, 18311, 18313, 18314, 18315, 18316, 18317, 18318, 18320, 18321, 18322, 18351, 18353, 18355, 18356, 18358, 18360, 18361, 18362, 18364, 18365, 18367, 18368, 18369, 18370, 18371, 18372, 18373, 18374, 18375, 18376, 18283, 18284, 18285, 18286, 18287, 18288, 18289, 18290, 18291, 18292, 18347, 18348, 18349, 18350, 18363, 18352, 18354, 18357, 18359, 18366, 18278, 18279, 18280, 18281, 18282, 18307, 18308, 18309, 18310, 18312, 18319, 18333, 18334, 18336, 18338, 18377, 18378, 18379, 18380, 18381, 18268, 18269, 18270, 18271, 18272, 18273, 18274, 18275, 18276, 18277, 8140, 18407, 8144, 8135, 8139, 8137, 8131, 8127, 8128, 18408, 8133, 8130, 8142, 8146, 8141, 18409, 18410, 18411, 18412, 8143, 7363, 7376, 7377, 7372, 18413, 7378, 18414, 18415, 7373, 7374, 7369, 7370, 7366, 7364, 7368, 18382, 18383, 18384, 18385, 18386, 18387, 18388, 18389, 18390, 18391, 18416, 18392, 18393, 18394, 9147, 18395, 18417, 18396, 9146, 18397, 9143, 18398, 18399, 18418, 18400, 18401, 18402, 18403]

    loan_ids = [22061, 22062, 22063, 22064, 22065, 22066, 22067, 22068, 22069, 22070, 22071, 22072, 22073, 22074, 22075, 22076, 22077, 22078, 22079, 22080, 22081, 22082, 22083, 22084, 22085, 22086, 22087, 22088, 22089, 22090, 22091, 22092, 22093, 22094, 22095, 22096, 22097, 22098, 22099, 22100, 22101, 22102, 22103, 22104, 22105, 22106, 22107, 22108, 22109, 22110, 22111, 22112, 22113, 22114, 22115, 22116, 22117, 22118, 22119, 22120, 22121, 22122, 22123, 22124, 22125, 22126, 22127, 22128, 22129, 22130, 22131, 22132, 22133, 22134, 22135, 22136, 22137, 22138, 22139, 22140, 22141, 22142, 22143, 22144, 22145, 22146, 22147, 22148, 22149, 22150, 22151, 22152, 22153, 22154, 22155, 22156, 22157, 22158, 22159, 22160, 22161, 22162, 22163, 22164, 22165, 22166, 22167, 22168, 22169, 22170, 22171, 22172, 22173, 22174, 22175, 22176, 22177, 22178, 22179, 22180, 22181, 22182, 22183, 22184, 22185, 22186, 22187, 22188, 22189, 22190, 22191, 22192, 22193, 22194, 22195, 22196, 22197, 22198, 22199, 22200, 22201, 22202, 22203, 22204, 22205, 22206, 22207, 22208, 22209, 22210, 22211, 22212, 22213, 22214, 22215, 22216, 22217, 22218, 22219, 22220, 22221, 22222, 22223, 22224, 22225, 22226, 22227, 22228, 22229, 22230, 22231, 22232, 22233, 22234, 22235, 22236, 22237, 22238, 22239, 22240, 22241, 22242, 22243, 22244, 22245, 22246, 22247, 22248, 22249, 22250, 22251, 22252, 22253, 22254, 22255, 22256, 22257, 22258, 22259, 22260, 22261, 22262, 22263, 22264, 22265, 22266, 22267, 22268, 22269, 22270, 22271, 22272, 22273, 22274, 22275, 22276, 22277, 22278, 22279, 22280, 22281, 22282, 22283, 22284, 22285, 22286, 22287, 22288, 22289, 22290, 22291, 22292, 22293, 22294, 22295, 22296, 22297, 22298, 22299, 22300, 22301, 22302, 22303, 22304, 22305, 22306, 22307, 22308, 22309, 22310, 22311, 22312, 22313, 22314, 22315, 22316, 22317, 22318, 22319, 22320, 22321, 22322, 22323, 22324, 22325, 22326, 22327, 22328, 22329, 22330, 22331, 22332, 22333, 22334, 22335, 22336, 22337, 22338, 22339, 22340, 22341, 22342, 22343, 22344, 22345, 22346, 22347, 22348, 22349, 22350, 22351, 22352, 22353, 22354, 22355, 22356, 22357, 22358, 22359, 22360, 22361, 22362, 22363, 22364, 22365, 22366, 22367, 22368, 22369, 22370, 22371, 22372, 22373, 22374, 22375, 22376, 22377, 22378, 22379, 22380, 22381, 22382, 22383, 22384, 22385, 22386, 22387, 22388, 22389, 22390, 22391, 22392, 22393, 22394, 22395, 22396, 22397, 22398, 22399, 22400, 22401, 22402, 22403, 22404, 22405, 22406, 22407, 22408, 22409, 22410, 22411, 22412, 22413, 22414, 22415, 22416, 22417, 22418, 22419, 22420, 22421, 22422, 22423, 22424, 22425, 22426, 22427, 22428, 22429, 22430, 22431, 22432, 22433, 22434, 22435, 22436, 22437, 22438, 22439, 22440, 22441, 22442, 22443, 22444, 22445, 22446, 22447, 22448, 22449, 22451, 22456, 22457, 22458, 22459, 22460, 22461, 22462, 22463, 22464, 22465, 22466, 22467, 22468, 22469, 22470, 22471, 22472, 22473, 22474, 22475, 22476, 22477, 22478, 22479, 22480, 22481, 22482, 22483, 22484, 22485, 22486, 22487, 22488, 22489, 22490, 22491, 22492, 22493, 22494, 22495, 22496, 22497, 22498, 22499, 22500, 22501, 22502, 22503, 22504, 22505, 22506, 22507, 22508, 22509, 22510, 22511, 22512, 22513, 22514, 22515, 22516, 22517, 22518, 22519, 22520, 22521, 22522, 22523, 22524, 22525, 22526, 22527, 22528, 22529, 22530, 22531, 22532, 22533, 22534, 22535, 22536, 22537, 22538, 22539, 22540, 22541, 22542, 22543, 22544, 22545, 22546, 22547, 22548, 22549, 22550, 22551, 22552, 22553, 22554, 22555, 22556, 22557, 22558, 22559, 22560, 22561, 22562, 22563, 22564, 22565, 22566, 22567, 22568, 22569, 22570, 22571, 22572, 22573, 22574, 22575, 22576, 22577, 22578, 22579, 22580, 22581, 22582, 22583, 22584, 22585, 22586, 22587, 22588, 22589, 22590, 22591, 22592, 22593, 22594, 22595, 22596, 22597, 22598, 22599, 22600, 22601, 22602, 22603, 22604, 22605, 22606, 22607, 22608, 22609, 22610, 22611, 22612, 22613, 22614, 22615, 22616, 22617, 22618, 22619, 22620, 22621, 22622, 22623, 22624, 22625, 22626, 22627, 22628, 22629, 22630, 22631, 22632, 22633, 22634, 22635, 22636, 22637, 22638, 22639, 22640, 22641, 22642, 22643, 22644, 22645, 22646, 22647, 22648, 22649, 22650, 22651, 22652, 22653, 22654, 22655, 22656, 22657, 22658, 22659, 22660, 22661, 22662, 22663, 22664, 22665, 22666, 22667, 22668, 22669, 22670, 22671, 22672, 22673, 22674, 22675, 22676, 22677, 22678, 22679, 22680, 22681, 22682, 22683, 22684, 22685, 22686, 22687, 22688, 22689, 22690, 22691, 22692, 22693, 22694, 22695, 22696, 22697, 22698, 22699, 22700, 22701, 22702, 22703, 22704, 22705, 22706, 22707, 22708, 22709, 22710, 22711, 22712, 22713, 22714, 22715, 22716, 22717, 22718, 22719, 22720, 22721, 22722, 22723, 22724, 22725, 22726, 22727, 22728, 22729, 22730, 22731, 22732, 22733, 22734, 22735, 22736, 22737, 22738, 22739, 22740, 22741, 22742, 22743, 22744, 22745, 22746, 22747, 22748, 22749, 22750, 22751, 22752, 22753, 22754, 22755, 22756, 22757, 22758, 22759, 22760, 22761, 22762, 22763, 22764, 22765, 22766, 22767, 22768, 22769, 22770, 22771, 22772, 22773, 22774, 22775, 22776, 22777, 22778, 22779, 22780, 22781, 22782, 22783, 22784, 22785, 22786, 22787, 22788, 22789, 22790, 22791, 22792, 22793, 22794, 22795, 22796, 22797, 22798, 22799, 22800, 22801, 22802, 22803, 22804, 22805, 22806, 22807, 22808, 22809, 22810, 22811, 22812, 22813, 22814, 22815, 22816, 22817, 22818, 22819, 22820, 22821, 22822, 22823, 22824, 22825, 22826, 22827, 22828, 22829, 22830, 22831, 22832, 22833, 22834, 22835, 22836, 22837, 22838, 22839, 22840, 22841, 22842, 22843, 22844, 22845, 22846, 22847, 22848, 22849, 22850, 22851, 22852, 22853, 22854, 22855, 22856, 22857, 22858, 22859, 22860, 22861, 22862, 22863, 22864, 22865, 22866, 22867, 22868, 22869, 22870, 22871, 22872, 22873, 22874, 22875, 22876, 22877, 22878, 22879, 22880, 22881, 22882, 22883, 22884, 22885, 22886, 22887, 22888, 22889, 22890, 22891, 22892, 22893, 22894, 22895, 22896, 22897, 22898, 22899, 22900, 22901, 22902, 22903, 22904, 22905, 22906, 22907, 22908, 22909, 22910, 22911, 22912, 22913, 22914, 22915, 22916, 22917, 22918, 22919, 22920, 22921, 22922, 22923, 22924, 22925, 22926, 22927, 22928, 22929, 22930, 22931, 22932, 22933, 22934, 22935, 22936, 22937, 22938, 22939, 22940, 22941, 22942, 22943, 22944, 22945, 22946, 22948, 22949, 0, 22061, 22062, 22063, 22064, 22065, 22066, 22067, 22068, 22069, 22070, 22071, 22072, 22073, 22074, 22075, 22076, 22077, 22078, 22079, 22080, 22081, 22082, 22083, 22084, 22085, 22086, 22087, 22088, 22089, 22090, 22091, 22092, 22093, 22094, 22095, 22096, 22097, 22098, 22099, 22100, 22101, 22102, 22103, 22104, 22105, 22106, 22107, 22108, 22109, 22110, 22111, 22112, 22113, 22114, 22115, 22116, 22117, 22118, 22119, 22120, 22121, 22122, 22123, 22124, 22125, 22126, 22127, 22128, 22129, 22130, 22131, 22132, 22133, 22134, 22135, 22136, 22137, 22138, 22139, 22140, 22141, 22142, 22143, 22144, 22145, 22146, 22147, 22148, 22149, 22150, 22151, 22152, 22153, 22154, 22155, 22156, 22157, 22158, 22159, 22160, 22161, 22162, 22163, 22164, 22165, 22166, 22167, 22168, 22169, 22170, 22171, 22172, 22173, 22174, 22175, 22176, 22177, 22178, 22179, 22180, 22181, 22182, 22183, 22184, 22185, 22186, 22187, 22188, 22189, 22190, 22191, 22192, 22193, 22194, 22195, 22196, 22197, 22198, 22199, 22200, 22201, 22202, 22203, 22204, 22205, 22206, 22207, 22208, 22209, 22210, 22211, 22212, 22213, 22214, 22215, 22216, 22217, 22218, 22219, 22220, 22221, 22222, 22223, 22224, 22225, 22226, 22227, 22228, 22229, 22230, 22231, 22232, 22233, 22234, 22235, 22236, 22237, 22238, 22239, 22240, 22241, 22242, 22243, 22244, 22245, 22246, 22247, 22248, 22249, 22250, 22251, 22252, 22253, 22254, 22255, 22256, 22257, 22258, 22259, 22260, 22261, 22262, 22263, 22264, 22265, 22266, 22267, 22268, 22269, 22270, 22271, 22272, 22273, 22274, 22275, 22276, 22277, 22278, 22279, 22280, 22281, 22282, 22283, 22284, 22285, 22286, 22287, 22288, 22289, 22290, 22291, 22292, 22293, 22294, 22295, 22296, 22297, 22298, 22299, 22300, 22301, 22302, 22303, 22304, 22305, 22306, 22307, 22308, 22309, 22310, 22311, 22312, 22313, 22314, 22315, 22316, 22317, 22318, 22319, 22320, 22321, 22322, 22323, 22324, 22325, 22326, 22327, 22328, 22329, 22330, 22331, 22332, 22333, 22334, 22335, 22336, 22337, 22338, 22339, 22340, 22341, 22342, 22343, 22344, 22345, 22346, 22347, 22348, 22349, 22350, 22351, 22352, 22353, 22354, 22355, 22356, 22357, 22358, 22359, 22360, 22361, 22362, 22363, 22364, 22365, 22366, 22367, 22368, 22369, 22370, 22371, 22372, 22373, 22374, 22375, 22376, 22377, 22378, 22379, 22380, 22381, 22382, 22383, 22384, 22385, 22386, 22387, 22388, 22389, 22390, 22391, 22392, 22393, 22394, 22395, 22396, 22397, 22398, 22399, 22400, 22401, 22402, 22403, 22404, 22405, 22406, 22407, 22408, 22409, 22410, 22411, 22412, 22413, 22414, 22415, 22416, 22417, 22418, 22419, 22420, 22421, 22422, 22423, 22424, 22425, 22426, 22427, 22428, 22429, 22430, 22431, 22432, 22433, 22434, 22435, 22436, 22437, 22438, 22439, 22440, 22441, 22442, 22443, 22444, 22445, 22446, 22447, 22448, 22449, 22451, 22456, 22457, 22458, 22459, 22460, 22461, 22462, 22463, 22464, 22465, 22466, 22467, 22468, 22469, 22470, 22471, 22472, 22473, 22474, 22475, 22476, 22477, 22478, 22479, 22480, 22481, 22482, 22483, 22484, 22485, 22486, 22487, 22488, 22489, 22490, 22491, 22492, 22493, 22494, 22495, 22496, 22497, 22498, 22499, 22500, 22501, 22502, 22503, 22504, 22505, 22506, 22507, 22508, 22509, 22510, 22511, 22512, 22513, 22514, 22515, 22516, 22517, 22518, 22519, 22520, 22521, 22522, 22523, 22524, 22525, 22526, 22527, 22528, 22529, 22530, 22531, 22532, 22533, 22534, 22535, 22536, 22537, 22538, 22539, 22540, 22541, 22542, 22543, 22544, 22545, 22546, 22547, 22548, 22549, 22550, 22551, 22552, 22553, 22554, 22555, 22556, 22557, 22558, 22559, 22560, 22561, 22562, 22563, 22564, 22565, 22566, 22567, 22568, 22569, 22570, 22571, 22572, 22573, 22574, 22575, 22576, 22577, 22578, 22579, 22580, 22581, 22582, 22583, 22584, 22585, 22586, 22587, 22588, 22589, 22590, 22591, 22592, 22593, 22594, 22595, 22596, 22597, 22598, 22599, 22600, 22601, 22602, 22603, 22604, 22605, 22606, 22607, 22608, 22609, 22610, 22611, 22612, 22613, 22614, 22615, 22616, 22617, 22618, 22619, 22620, 22621, 22622, 22623, 22624, 22625, 22626, 22627, 22628, 22629, 22630, 22631, 22632, 22633, 22634, 22635, 22636, 22637, 22638, 22639, 22640, 22641, 22642, 22643, 22644, 22645, 22646, 22647, 22648, 22649, 22650, 22651, 22652, 22653, 22654, 22655, 22656, 22657, 22658, 22659, 22660, 22661, 22662, 22663, 22664, 22665, 22666, 22667, 22668, 22669, 22670, 22671, 22672, 22673, 22674, 22675, 22676, 22677, 22678, 22679, 22680, 22681, 22682, 22683, 22684, 22685, 22686, 22687, 22688, 22689, 22690, 22691, 22692, 22693, 22694, 22695, 22696, 22697, 22698, 22699, 22700, 22701, 22702, 22703, 22704, 22705, 22706, 22707, 22708, 22709, 22710, 22711, 22712, 22713, 22714, 22715, 22716, 22717, 22718, 22719, 22720, 22721, 22722, 22723, 22724, 22725, 22726, 22727, 22728, 22729, 22730, 22731, 22732, 22733, 22734, 22735, 22736, 22737, 22738, 22739, 22740, 22741, 22742, 22743, 22744, 22745, 22746, 22747, 22748, 22749, 22750, 22751, 22752, 22753, 22754, 22755, 22756, 22757, 22758, 22759, 22760, 22761, 22762, 22763, 22764, 22765, 22766, 22767, 22768, 22769, 22770, 22771, 22772, 22773, 22774, 22775, 22776, 22777, 22778, 22779, 22780, 22781, 22782, 22783, 22784, 22785, 22786, 22787, 22788, 22789, 22790, 22791, 22792, 22793, 22794, 22795, 22796, 22797, 22798, 22799, 22800, 22801, 22802, 22803, 22804, 22805, 22806, 22807, 22808, 22809, 22810, 22811, 22812, 22813, 22814, 22815, 22816, 22817, 22818, 22819, 22820, 22821, 22822, 22823, 22824, 22825, 22826, 22827, 22828, 22829, 22830, 22831, 22832, 22833, 22834, 22835, 22836, 22837, 22838, 22839, 22840, 22841, 22842, 22843, 22844, 22845, 22846, 22847, 22848, 22849, 22850, 22851, 22852, 22853, 22854, 22855, 22856, 22857, 22858, 22859, 22860, 22861, 22862, 22863, 22864, 22865, 22866, 22867, 22868, 22869, 22870, 22871, 22872, 22873, 22874, 22875, 22876, 22877, 22878, 22879, 22880, 22881, 22882, 22883, 22884, 22885, 22886, 22887, 22888, 22889, 22890, 22891, 22892, 22893, 22894, 22895, 22896, 22897, 22898, 22899, 22900, 22901, 22902, 22903, 22904, 22905, 22906, 22907, 22908, 22909, 22910, 22911, 22912, 22913, 22914, 22915, 22916, 22917, 22918, 22919, 22920, 22921, 22922, 22923, 22924, 22925, 22926, 22927, 22928, 22929, 22930, 22931, 22932, 22933, 22934, 22935, 22936, 22937, 22938, 22939, 22940, 22941, 22942, 22943, 22944, 22945, 22946, 22948, 22949]

    disbursal_dates = [Date.new(2012, 5, 28), Date.new(2012, 5, 29), Date.new(2012, 5, 30), Date.new(2012, 6, 1), Date.new(2012, 6, 4), Date.new(2012, 6, 5), Date.new(2012, 6, 6), Date.new(2012, 6, 7), Date.new(2012, 6, 8), Date.new(2012, 6, 9), Date.new(2012, 6, 14), Date.new(2012, 6, 15), Date.new(2012, 6, 16)]

    date = Date.new(2012, 4, 30)

    #following are the various dates on which monthly cash flows is being calculated.
    from_dates = [Date.new(2012, 5, 1), Date.new(2012, 6, 1), Date.new(2012, 7, 1), Date.new(2012, 8, 1), Date.new(2012, 9, 1), Date.new(2012, 10, 1), Date.new(2012, 11, 1), Date.new(2012, 12, 1), Date.new(2013, 1, 1), Date.new(2013, 2, 1), Date.new(2013, 3, 1), Date.new(2013, 4, 1), Date.new(2013, 5, 1)]

    to_dates = [Date.new(2012, 5, 31), Date.new(2012, 6, 30), Date.new(2012, 7, 31), Date.new(2012, 8, 31), Date.new(2012, 9, 30), Date.new(2012, 10, 31), Date.new(2012, 11, 30), Date.new(2012, 12, 31), Date.new(2013, 1, 31), Date.new(2013, 2, 28), Date.new(2013, 3, 31), Date.new(2013, 4, 30), Date.new(2013, 5, 31)]

    sl_no = 0

    f = File.open("tmp/mas_financials_#{DateTime.now.to_s}.csv", "w")
    f.puts("\"Sl. No.\", \"Branch Id\", \"Branch Name\", \"Center Id\", \"Center Name\", \"Client Id\", \"Client Name\", \"Date of Birth\", \"Caste\", \"Residence Address\", \"Residence Pin Code\", \"State\", \"Residence Phone Number\", \"Name of Assets\", \"Gross Income\", \"Gender\", \"Name of Marketing Executive\", \"Loan Id\", \"Purpose of Loans\", \"Category of Loanee\", \"Cycle Number\", \"Date of Disbursement\", \"Disbursement Mode\", \"Disbursement Cheque Number\", \"First Installment Date\", \"Last Installment Date\", \"Scheme IRR (%)\", \"Amount Financed\", \"Upfront Fees Amount in Rs.\", \"Insurance Charges\", \"Any Other Charges\", \"Installment Amount\", \"Tenure in Weeks\", \"Advance EMI\", \"No. Of Installment\", \"EMI Frequency\", \"Seasoning\", \"OD. Inst.\", \"Od. Amt. Rs.\", \"SD Amt. Rs.\", \"SD. Refund / Scheme Refund\", \"Mode of Repayment\", \"KYC Detail\", \"Future Capital O/S Amt. Rs.\", \"Future O/S Installment\", \"Future Receivable Amt. Rs.\", \"Cash Flow in March 2012\", \"Cash Flow in April 2012\", \"Cash Flow in May 2012\", \"Cash Flow in June 2012\", \"Cash Flow in July 2012\", \"Cash Flow in August 2012\", Cash Flow in September 2012, \"Cash Flow in October 2012\", \"Cash Flow in November 2012\", \"Cash Flow in December 2012\", \"Cash Flow in January 2013\", \"Cash Flow in February 2013\", \"Cash Flow in March 2013\", \"Cash Flow in April 2013\", \"Cash Flow in May 2013\", \"Cash Flow in June 2013\", \"Cash Flow in July 2013\", \"Cash Flow in August 2013\", \"Cash Flow in September 2013\", \"Cash Flow in October 2013\", \"Cash Flow in November 2013\", \"Cash Flow in December 2013\", \"Cash Flow in January 2014\", \"Cash Flow in February 2014\", \"Cash Flow in March 2014\", \"Cash Flow in April 2014\", \"Cash Flow in May 2014\", \"Cash Flow in June 2014\", \"Cash Flow in July 2014\", \"Cash Flow in August 2014\"")

    Loan.all(:id => loan_ids, :client_id => client_ids, :disbursal_date => disbursal_dates).each do |loan|

      sl_no += 1

      client = Client.get(loan.client_id)
      client_id = client.id
      client_name = client.name
      client_date_of_birth = client.date_of_birth
      client_caste = client.caste
      client_address = ""
      client_address_pin_code = client.address_pin
      client_state = "Bihar"
      if client.phone_number
        client_phone_number = client.phone_number
      else
        client_phone_number = "Not Specified"
      end
      client_name_of_assets = "NA"
      client_gross_income = client.total_income
      client_gender = client.gender.capitalize
      client_marketing_executive = client.center.manager.name

      center_id = client.center.id
      center_name = client.center.name

      branch_id = client.center.branch.id
      branch_name = client.center.branch.name

      loan_id = loan.id
      loan_cycle_number = loan.cycle_number
      loan_category = "NA"
      loan_purpose = (loan.occupation ? loan.occupation.name : "Not specified")
      loan_disbursal_date = loan.disbursal_date
      if loan.cheque_number.empty?
        loan_disbursement_mode = "Cash"
        loan_disbursement_cheque_number = "NA"
      else
        loan_disbursement_mode = "Cheque"
        loan_disbursement_cheque_number = loan.cheque_number
      end
      loan_first_installment_date = loan.scheduled_first_payment_date
      loan_last_installment_date = loan.loan_history.max(:date, :conditions => ['principal_due_today != ?', 0.0], :conditions => ['interest_due_today != ?', 0.0])
      loan_scheme_irr = (loan.irr * 100)
      loan_product_name = loan.loan_product.name
      loan_amount_financed = loan.amount
      loan_upfront_fees = loan.applicable_fees[0].amount
      loan_insurance_charges = loan.applicable_fees[1].amount
      loan_any_other_charges = "NA"
      loan_installment_amount = (loan.scheduled_principal_for_installment(1) + loan.scheduled_interest_for_installment(1))
      loan_tenure = loan.number_of_installments
      loan_advance_emi = ""
      loan_number_of_installments = loan.number_of_installments
      loan_installment_frequency = loan.installment_frequency.to_s.capitalize
      loan_seasoning = "NA"
      loan_overdue_installment = 0
      loan_overdue_amount = 0
      loan_sd_amount = "NA"
      loan_sd_refund = "NA"
      loan_mode_of_repayment = "Cash"
      loan_kyc_details = "Yes"
      loan_future_outstanding_amount = loan.scheduled_outstanding_total_on(date)
      loan_future_outstanding_installment = (loan.number_of_installments - loan.number_of_installments_before(date))
      loan_future_receivable_amount = (loan.total_to_be_received - loan.total_received_up_to(date))

      if (loan.scheduled_first_payment_date >= from_dates[0] and loan.scheduled_first_payment_date <= to_dates[0])
        monthly_cash_flow_march_2012 = (loan.scheduled_principal_for_installment(1) + loan.scheduled_interest_for_installment(1))
      else
        monthly_cash_flow_march_2012 = 0
      end
      monthly_cash_flow_april_2012 = (loan.scheduled_outstanding_total_on(from_dates[1]) - loan.scheduled_outstanding_total_on(to_dates[1]))
      monthly_cash_flow_may_2012 = (loan.scheduled_outstanding_total_on(from_dates[2]) - loan.scheduled_outstanding_total_on(to_dates[2]))
      monthly_cash_flow_june_2012 = (loan.scheduled_outstanding_total_on(from_dates[3]) - loan.scheduled_outstanding_total_on(to_dates[3]))
      monthly_cash_flow_july_2012 = (loan.scheduled_outstanding_total_on(from_dates[4]) - loan.scheduled_outstanding_total_on(to_dates[4]))
      monthly_cash_flow_august_2012 = (loan.scheduled_outstanding_total_on(from_dates[5]) - loan.scheduled_outstanding_total_on(to_dates[5]))
      monthly_cash_flow_september_2012 = (loan.scheduled_outstanding_total_on(from_dates[6]) - loan.scheduled_outstanding_total_on(to_dates[6]))
      monthly_cash_flow_october_2012 = (loan.scheduled_outstanding_total_on(from_dates[7]) - loan.scheduled_outstanding_total_on(to_dates[7]))
      monthly_cash_flow_november_2012 = (loan.scheduled_outstanding_total_on(from_dates[8]) - loan.scheduled_outstanding_total_on(to_dates[8]))
      monthly_cash_flow_december_2012 = (loan.scheduled_outstanding_total_on(from_dates[9]) - loan.scheduled_outstanding_total_on(to_dates[9]))

      monthly_cash_flow_january_2013 = (loan.scheduled_outstanding_total_on(from_dates[10]) - loan.scheduled_outstanding_total_on(to_dates[10]))
      monthly_cash_flow_february_2013 = (loan.scheduled_outstanding_total_on(from_dates[11]) - loan.scheduled_outstanding_total_on(to_dates[11]))
      monthly_cash_flow_march_2013 = (loan.scheduled_outstanding_total_on(from_dates[12]) - loan.scheduled_outstanding_total_on(to_dates[12]))
      monthly_cash_flow_april_2013 = (loan.scheduled_outstanding_total_on(from_dates[13]) - loan.scheduled_outstanding_total_on(to_dates[13]))
      monthly_cash_flow_may_2013 = (loan.scheduled_outstanding_total_on(from_dates[14]) - loan.scheduled_outstanding_total_on(to_dates[14]))
      monthly_cash_flow_june_2013 = (loan.scheduled_outstanding_total_on(from_dates[15]) - loan.scheduled_outstanding_total_on(to_dates[15]))
      monthly_cash_flow_july_2013 = (loan.scheduled_outstanding_total_on(from_dates[16]) - loan.scheduled_outstanding_total_on(to_dates[16]))
      monthly_cash_flow_august_2013 = (loan.scheduled_outstanding_total_on(from_dates[17]) - loan.scheduled_outstanding_total_on(to_dates[17]))
      monthly_cash_flow_september_2013 = (loan.scheduled_outstanding_total_on(from_dates[18]) - loan.scheduled_outstanding_total_on(to_dates[18]))
      monthly_cash_flow_october_2013 = (loan.scheduled_outstanding_total_on(from_dates[19]) - loan.scheduled_outstanding_total_on(to_dates[19]))
      monthly_cash_flow_november_2013 = (loan.scheduled_outstanding_total_on(from_dates[20]) - loan.scheduled_outstanding_total_on(to_dates[20]))
      monthly_cash_flow_december_2013 = (loan.scheduled_outstanding_total_on(from_dates[21]) - loan.scheduled_outstanding_total_on(to_dates[21]))

      monthly_cash_flow_january_2014 = (loan.scheduled_outstanding_total_on(from_dates[22]) - loan.scheduled_outstanding_total_on(to_dates[22]))
      monthly_cash_flow_february_2014 = (loan.scheduled_outstanding_total_on(from_dates[23]) - loan.scheduled_outstanding_total_on(to_dates[23]))
      monthly_cash_flow_march_2014 = (loan.scheduled_outstanding_total_on(from_dates[24]) - loan.scheduled_outstanding_total_on(to_dates[24]))
      monthly_cash_flow_april_2014 = (loan.scheduled_outstanding_total_on(from_dates[25]) - loan.scheduled_outstanding_total_on(to_dates[25]))
      monthly_cash_flow_may_2014 = (loan.scheduled_outstanding_total_on(from_dates[26]) - loan.scheduled_outstanding_total_on(to_dates[26]))
      monthly_cash_flow_june_2014 = (loan.scheduled_outstanding_total_on(from_dates[27]) - loan.scheduled_outstanding_total_on(to_dates[27]))
      monthly_cash_flow_july_2014 = (loan.scheduled_outstanding_total_on(from_dates[28]) - loan.scheduled_outstanding_total_on(to_dates[28]))
      monthly_cash_flow_august_2014 = (loan.scheduled_outstanding_total_on(from_dates[29]) - loan.scheduled_outstanding_total_on(to_dates[29]))
      
      f.puts("#{sl_no}, #{branch_id}, \"#{branch_name}\", #{center_id}, \"#{center_name}\", #{client_id}, \"#{client_name}\", #{client_date_of_birth}, \"#{client_caste}\", \"#{client_address}\", #{client_address_pin_code}, \"#{client_state}\", #{client_phone_number}, \"#{client_name_of_assets}\", #{client_gross_income}, \"#{client_gender}\", \"#{client_marketing_executive}\", #{loan_id}, \"#{loan_purpose}\", \"#{loan_category}\", #{loan_cycle_number}, #{loan_disbursal_date}, \"#{loan_disbursement_mode}\", \"#{loan_disbursement_cheque_number}\", #{loan_first_installment_date}, #{loan_last_installment_date}, \"#{loan_scheme_irr}\", #{loan_amount_financed}, #{loan_upfront_fees}, #{loan_insurance_charges}, #{loan_any_other_charges}, #{loan_installment_amount}, #{loan_tenure}, #{loan_advance_emi}, #{loan_number_of_installments}, \"#{loan_installment_frequency}\", \"#{loan_seasoning}\", #{loan_overdue_installment}, #{loan_overdue_amount}, \"#{loan_sd_amount}\", \"#{loan_sd_refund}\", \"#{loan_mode_of_repayment}\", \"#{loan_kyc_details}\", #{loan_future_outstanding_amount}, #{loan_future_outstanding_installment}, #{loan_future_receivable_amount}, #{monthly_cash_flow_march_2012}, #{monthly_cash_flow_april_2012}, #{monthly_cash_flow_may_2012}, #{monthly_cash_flow_june_2012}, #{monthly_cash_flow_july_2012}, #{monthly_cash_flow_august_2012}, #{monthly_cash_flow_september_2012}, #{monthly_cash_flow_october_2012}, #{monthly_cash_flow_november_2012}, #{monthly_cash_flow_december_2012}, #{monthly_cash_flow_january_2013}, #{monthly_cash_flow_february_2013}, #{monthly_cash_flow_march_2013}, #{monthly_cash_flow_april_2013}, #{monthly_cash_flow_may_2013}, #{monthly_cash_flow_june_2013}, #{monthly_cash_flow_july_2013}, #{monthly_cash_flow_august_2013}, #{monthly_cash_flow_september_2013}, #{monthly_cash_flow_october_2013}, #{monthly_cash_flow_november_2013}, #{monthly_cash_flow_december_2013}, #{monthly_cash_flow_january_2014}, #{monthly_cash_flow_february_2014}, #{monthly_cash_flow_march_2014}, #{monthly_cash_flow_april_2014}, #{monthly_cash_flow_may_2014}, #{monthly_cash_flow_june_2014}, #{monthly_cash_flow_july_2014}, #{monthly_cash_flow_august_2014}")

    end
    f.close
  end

  desc "Generates report of MAS financials for Intellecash for second term loan"
  task :mas_financials_second_term_loan do

    client_ids = [15567,15568,15540,15569,15570,15571,6153,6132,6133,6156,6145,6136,6151,6148,6141,15572,15573,15574,15575,15576,15588,15589,15590,15591,15592,4814,4805,15666,4830,15593,4816,4811,15594,5428,15595,15596,4812,15667,15597,4831,5989,6492,5986,6491,6502,5991,6480,6482,5993,6485,15539,5984,5981,6496,6507,5994,6489,6483,5985,6477,6487,5992,6505,5995,6498,6500,5983,5988,5990,5987,6004,15646,6011,15655,5999,15656,6015,15658,6001,15660,6007,6012,6006,15662,6009,15648,15650,6013,15652,6014,15653,6008,5998,6580,6010,6584,6574,5997,6575,6582,6577,6356,6355,6573,6358,6357,6583,6359,15559,6874,6360,15560,6361,6869,6362,6870,6363,6872,6364,15561,6368,6367,6369,15553,5693,15554,6033,5697,5696,6027,5695,6029,15508,6053,5959,6055,6032,6057,6049,6022,15607,6619,15641,15644,6617,15637,15639,6615,6620,6613,6332,6330,6320,5343,6319,5345,6318,15609,6321,6322,15493,15494,15495,15496,15497,15499,15501,15505,15506,15507,15636,15638,15640,15642,15643,15647,15649,15651,15654,15657,15659,15661,15663,15664,15665,15587,15598,15599,15600,15601,15602,15603,15604,15605,15606,15626,15627,15628,15629,15630,15631,15632,15633,15634,15635,15608,15612,15613,15614,15615,15616,15617,15618,15619,15620,15621,15622,15623,15624,15625,15511,15512,15515,15518,15523,15678,15709,15710,15711,15712,15713,15714,15715,15716,15717,15668,15669,15670,15671,15672,15673,15674,15675,15676,15677,15679,15680,15681,15682,15683,15684,15685,15686,15687,15688,15689,15690,15691,15692,15693,15694,15695,15696,15697,15698,15699,15700,15701,15702,15703,15704,15705,15706,15707,15708,15759,15755,15753,15750,15748,5485,5486,5484,15611,15610,15764,6524,5932,15769,6527,5924,5926,15768,5920,6522,5934,6512,6514,5918,6517,5923,6531,5925,5922,15775,6060,3697,5579,6072,5415,6074,5418,6062,6058,15733,15718,15736,15719,15720,15721,15724,15725,6241,15728,6244,15730,6247,15731,6246,15732,6242,15735,15737,15738,15740,5750,5752,6236,6234,6238,7522,6231,6232,6230,7523,15729,5748,15734,15726,15727,15558,6002,6000,6003,5996,6590,6599,6431,6595,6430,6597,6434,6594,6432,6593,15770,15773,15771,15772,6592,3512,5190,6226,7041,5189,6224,7056,6223,7051,5192,7043,7046,5188,6227,15776,5183,5187,15778,15781,7048,15782,15779,15749,15780,15783,15751,15784,15756,6807,15752,6802,15758,6809,6800,5796,7035,15739,5792,15741,5794,4925,15742,5797,15743,5795,7036,15744,4920,6804,7038,15562,15563,2055,15564,15565,4016,4018,15566,15754,15757,14839,15850,15855,15857,15859,15803,15805,15806,15807,15808,15809,15810,15811,15812,15814,15819,15828,15830,15832,15833,15835,15837,15838,15841,15846,15760,15763,15765,15767,15774,15777,15785,15786,15787,15788,15789,15790,15798,15800,15801,15745,15746,15747,15816,15820,15821,15823,15824,15825,15826,15829,15840,15844,15847,15848,15577,15578,15579,15580,15581,15582,15583,15584,15585,15586,15827,15831,15834,15836,15839,15842,15843,15845,15849,15851,15852,15853,15854,15856,15858,6550,6549,6554,15761,15762,15867,15868,15869,15870,15871,6936,6931,6933,6935,6941,6939,6112,6932,15877,6930,15878,15860,15879,15861,15880,15862,15872,15873,15863,15874,15864,15875,15876,15865,15866,5865,6632,6610,5857,6618,15815,5867,6621,5859,6628,5860,5861,6633,5862,6612,15817,15813,6626,5871,5870,6616,5872,6630,5868,5869,15818,5864,15822,5866,6634,15896,15898,15899,15900,5884,15902,5883,15905,5880,15906,15897,15907,5888,15910,5878,15912,5877,5876,5873,5875,5879,5881,5874,5887,5886,15966,15969,15973,15975,15980,15984,15986,15988,15990,15991,15925,15926,15927,15928,15929,15931,15933,15936,15938,15939,15940,15941,15954,15957,15960,15901,15903,15909,15911,15913,15914,15915,15916,15918,15919,15920,15921,15922,15923,15924,15881,15882,15883,15884,15885,15886,15887,15888,15889,15890,15891,15892,15893,15894,15895,5466,5464,5477,5469,15930,15932,5468,5470,15934,5472,5465,5475,15935,5463,15937,15904,6034,6038,15995,6035,15997,15908,6045,6044,6043,6040,6042,15992,6024,15917,6028,6031,6026,16007,16009,16011,16013,6720,15999,6589,16001,16003,6585,6587,15961,5785,15962,6586,15965,16017,16016,5786,15968,5783,15971,6588,15976,15979,16018,15982,15985,16019,3500,15950,15989,16020,15952,15955,16021,15959,7090,7089,7084,7086,6277,15944,15993,6273,6279,15994,6284,6289,6283,15722,15996,15723,15998,2390,2385,2386,15963,15964,15967,15970,15972,15974,15977,16037,16038,15978,16039,15983,15987,16045,16040,16000,16002,16004,16005,16008,16010,16012,16014,16015,16006,16063,16068,16073,16074,16076,16041,16077,16078,16079,16081,16042,16085,16044,16047,16048,16051,16053,16055,16057,16060,16093,16095,16022,16023,16024,16025,16026,16027,16028,16029,16030,16031,16032,16033,16034,16035,16036,16103,16107,16043,16110,16046,16117,16050,16118,16121,16052,16054,16124,16056,16127,16058,16059,16061,16064,16062,16065,16067,16066,16069,16070,16071,16092,16072,16075,16105,16106,16109,16114,16115,16119,16123,16125,16126,16128,16129,16130,16080,16082,16131,16083,16084,16086,16132,16087,16133,16088,16089,16090,16091,16094,16096,16097,16098,16099,16100,6155,16101,16102,16104,16108,16111,16112,6149,16113,16116,6140,16120,16122,6146,6152,6135,16134,6144,6143,6150,16135,6154,6138,6134,6147,15791,15792,15793,15794,15795,15796,15797,15799,15802,15804,16141,16142,16143,16144,16145,5939,5941,6661,5946,6658,6660,5943,6657,16148,16136,5948,5453,5949,5450,5451,5952,16146,16137,6323,16147,6327,5954,5953,16150,5957,16151,16138,16149,16139,16140,16152,16153,16154,16155,16160,16159,16158,16157,16156,16175,16176,16178,16180,16182,16161,16162,16163,16165,16166,16168,16169,16170,16172,16173,16177,16179,16181,16183,16184,16185,16186,16187,16189,16190,16191,16192,16194,16195,16196,16198,16199,16200,16201,16204,16209,16211,16213,16214,16215,16188,16193,16197,16205,16207,16210,16212,16216,16219,16224,16225,16227,16229,16232,16233,16217,16218,16220,16221,16222,16223,16226,16228,16230,16231,5940,16234,16164,16167,16171,16174,16235,16236,16237,5180,16238,16202,16239,16203,16240,16241,16206,16243,16208,16245,16242,16244,16246,16247,16248,17771,17774,17776,17777,17779,17746,17747,17748,17749,17750,17775,17753,17764,17768,17770,17758,17760,17762,17763,17765,17737,17739,9451,9454,9457,9455,9453,9449,9448,9458,17731,17732,17733,7124,7120,7121,7122,6239,7123,6237,6245,6240,6243,6249,6248,7450,7449,7448,7447,7454,7453,7452,7455,7451,17734,7291,17789,7292,7295,7293,7286,7289,7288,7290,17790,7296,7287,7302,7304,7305,17798,17799,17800,17801,17802,17791,17792,17793,17794,17795,186,183,184,185,7702,7911,7908,7912,17796,17797,17803,17804,17805,17806,17807,17808,17809,17810,17811,17812,17833,17834,17835,17836,17837,17813,17814,17815,17816,17821,17826,17828,17830,17831,17832,17838,17840,17841,17839,17842,17817,17818,17819,17820,17822,17823,17824,17825,17827,17829,17843,17844,17845,17846,17847,17848,17849,17850,17851,17852,17853,17854,17855,17856,17857,17858,17859,17860,17861,17862,17878,7307,7312,7333,7313,17879,7309,7327,7325,17880,17881,7341,17882,7334,17883,17863,17864,17865,17866,17867,17868,17869,17870,17871,17872,17873,17874,17875,17876,17877,17914,17915,17916,17917,17918,17884,17885,17887,17888,17889,17890,17893,17894,17896,17897,17899,17900,17901,17903,17904,17920,17922,17923,17924,17926,17905,17907,17908,17910,17911,17931,17932,17933,17934,17935,17936,17937,17939,17940,17941,17943,17944,17945,17946,17947,17948,17949,17950,17951,17952,17953,6949,6971,6960,17954,6977,17955,17956,6970,6954,17957,6958,17958,6956,6951,17987,17973,17974,17978,17981,17969,17970,17971,17984,17972,17913,17912,17909,17891,17906,17886,17892,17895,17902,17898,18056,18061,18063,18064,18065,18069,18071,18072,18073,18075,18077,18078,18080,18081,18082,18053,18054,18055,18066,18067,18046,18048,18049,18051,18052,18006,18008,18009,18060,18089,18092,18095,18097,17919,17921,17925,17929,17930,17938,17942,17959,17961,17963,18042,18043,18044,18045,18047,18013,18014,18015,18018,18019,18020,18022,18023,18024,18025,18026,18027,18028,18029,18030,18011,18021,7607,7606,7608,7611,7614,17960,17962,7615,7612,7619,7610,7613,17964,17965,17966,7605,7617,7618,17967,17968,17569,17571,7665,7669,7666,7667,7668,7663,7661,7664,7387,7381,7384,7386,18031,18033,7261,7264,7266,18032,7262,18035,18036,18038,18039,190,640,17989,189,17927,17991,17992,17928,17994,7657,7658,7655,7656,18041,18068,18070,18074,18076,18079,18083,18084,18085,18086,18088,18096,18099,18100,17995,18101,17999,18001,18103,18007,18010,18012,17975,17976,17977,17979,17980,17982,17983,17985,17986,17988,18050,18057,18058,18059,18062,18087,18090,18091,18093,18094,7415,7418,7412,7413,7416,7419,18119,7414,7422,7421,18124,7436,7439,7437,7438,18112,18113,18114,18115,18116,18118,18120,18121,18122,18123,18125,18126,18127,18128,18129,18130,18131,18132,18133,18134,18145,18146,18147,18148,18149,18016,18150,18151,18152,18153,18154,7359,7356,7357,7358,7360,5018,18155,18156,18157,18158,18017,18034,18037,18040,17990,17993,17996,17997,17998,18000,18002,18003,18004,18005,18161,18162,18163,18098,18164,18102,18166,18104,18105,18106,18168,95,93,7367,23,27,36,33,32,35,24,21,25,22,92,18107,18108,18109,7516,18110,18111,5167,7510,7513,7517,8429,8431,8430,8433,8432,7848,7846,7844,7852,7850,7464,7463,7462,7461,18169,18117,18135,18136,18137,18138,18139,18140,18141,18142,18159,18143,18144,18160,18165,18167,18170,18171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,18185,18186,18187,18188,18189,18190,18191,18192,18193,18194,7400,8791,7396,7404,7403,8790,7399,7408,7406,7409,8793,18256,18257,7397,7405,7402,7407,8792,18195,18205,18260,8794,18207,18209,18211,18212,18213,18215,18216,18217,18218,18219,18220,18221,18222,18223,18226,18230,18231,18232,7629,7627,7628,7625,7626,7632,7634,18243,7633,7624,7630,7620,7623,7622,7621,9358,9355,9353,9361,18248,7898,7897,7901,7904,7905,7899,7900,7902,7903,7906,8352,8353,8354,8351,18249,18196,18197,18198,18199,18200,18201,18202,18203,18204,18206,18208,18210,18214,18293,18294,18224,18225,18227,18228,18229,18233,18234,18235,18236,18237,18238,18239,18240,18241,18242,18296,18297,18298,18300,18301,18302,18303,18304,18305,18306,18250,18251,18252,18253,18254,18255,18258,18259,18261,18262,18263,18264,18265,18266,18267,18323,18324,18325,18326,18327,18328,18329,18330,18331,18332,18335,18337,18339,18340,18341,18342,18343,18344,18345,18346,18311,18313,18314,18315,18316,18317,18318,18320,18321,18322,18351,18353,18355,18356,18358,18360,18361,18362,18364,18365,18367,18368,18369,18370,18371,18372,18373,18374,18375,18376,18283,18284,18285,18286,18287,18288,18289,18290,18291,18292,18347,18348,18349,18350,18363,18352,18354,18357,18359,18366,18278,18279,18280,18281,18282,18307,18308,18309,18310,18312,18319,18333,18334,18336,18338,18377,18378,18379,18380,18381,18268,18269,18270,18271,18272,18273,18274,18275,18276,18277,8140,18407,8144,8135,8139,8137,8131,8127,8128,18408,8133,8130,8142,8146,8141,18409,18410,18411,18412,8143,7363,7376,7377,7372,18413,7378,18414,18415,7373,7374,7369,7370,7366,7364,7368,18382,18383,18384,18385,18386,18387,18388,18389,18390,18391,18416,18392,18393,18394,9147,18395,18417,18396,9146,18397,9143,18398,18399,18418,18400,18401,18402,18403]

    #loan_ids = [19246,19247,19248,19249,19250,19251,19252,19253,19254,19255,19256,19257,19258,19259,19260,19261,19262,19263,19264,19265,19267,19268,19269,19270,19271,19272,19273,19274,19275,19276,19277,19278,19279,19280,19281,19282,19283,19284,19285,19286,19287,19288,19289,19290,19291,19292,19293,19294,19295,19296,19297,19298,19299,19300,19301,19302,19303,19304,19305,19306,19307,19308,19309,19310,19311,19312,19313,19314,19315,19316,19317,19318,19319,19320,19321,19322,19323,19324,19325,19326,19327,19328,19329,19330,19331,19332,19333,19334,19335,19336,19337,19338,19339,19340,19341,19342,19343,19344,19345,19346,19347,19348,19349,19350,19351,19352,19353,19354,19355,19356,19357,19358,19359,19360,19361,19362,19363,19364,19365,19366,19367,19368,19369,19370,19371,19372,19373,19374,19375,19376,19377,19378,19379,19380,19381,19382,19383,19384,19385,19386,19388,19389,19390,19391,19392,19393,19394,19395,19396,19397,19398,19399,19400,19401,19402,19403,19404,19405,19406,19407,19408,19409,19410,19411,19412,19413,19414,19415,19416,19417,19418,19419,19420,19421,19422,19423,19424,19425,19426,19427,19428,19429,19430,19431,19432,19433,19434,19435,19436,19437,19438,19439,19440,19441,19442,19443,19444,19445,19446,19447,19448,19449,19450,19451,19452,19453,19454,19455,19456,19457,19458,19459,19460,19461,19462,19463,19464,19465,19466,19467,19468,19469,19470,19471,19472,19473,19474,19475,19476,19477,19478,19479,19480,19481,19482,19483,19484,19485,19486,19487,19488,19489,19490,19491,19492,19493,19494,19495,19496,19497,19498,19499,19500,19501,19502,19503,19504,19505,19506,19507,19508,19509,19510,19511,19512,19513,19514,19515,19516,19517,19518,19519,19520,19521,19522,19523,19524,19525,19526,19527,19528,19529,19530,19531,19532,19533,19534,19535,19536,19537,19538,19539,19540,19541,19542,19543,19544,19545,19546,19547,19548,19549,19550,19551,19552,19553,19554,19555,19556,19557,19558,19559,19560,19561,19562,19563,19564,19565,19566,19567,19568,19569,19570,19571,19572,19573,19574,19575,19576,19577,19578,19579,19580,19581,19582,19583,19584,19585,19586,19587,19588,19589,19590,19591,19592,19593,19594,19595,19596,19597,19598,19599,19600,19601,19602,19603,19604,19605,19606,19607,19608,19609,19610,19611,19612,19613,19614,19615,19616,19617,19618,19619,19620,19621,19622,19623,19624,19625,19626,19627,19628,19629,19630,19631,19632,19633,19634,19635,19636,19637,19638,19639,19640,19641,19642,19643,19644,19645,19646,19647,19648,19649,19650,19651,19652,19653,19654,19655,19656,19657,19658,19659,19660,19661,19662,19663,19664,19665,19666,19667,19668,19669,19670,19671,19672,19673,19674,19675,19676,19677,19678,19679,19680,19681,19682,19683,19684,19685,19686,19687,19688,19689,19690,19691,19692,19693,19694,19695,19696,19697,19698,19699,19700,19701,19702,19704,19705,19706,19707,19708,19709,19710,19711,19712,19713,19714,19715,19716,19717,19718,19719,19720,19721,19722,19723,19724,19725,19726,19727,19728,19729,19730,19731,19732,19733,19734,19735,19736,19737,19738,19739,19740,19741,19742,19743,19744,19745,19746,19747,19748,19749,19750,19751,19752,19753,19754,19755,19756,19757,19758,19759,19760,19761,19762,19763,19764,19765,19766,19767,19768,19769,19770,19771,19772,19773,19774,19775,19776,19777,19778,19779,19780,19781,19782,19783,19784,19785,19786,19787,19788,19789,19790,19791,19792,19793,19794,19795,19796,19797,19798,19799,19800,19801,19802,19803,19804,19805,19806,19807,19808,19809,19810,19811,19812,19813,19814,19815,19816,19817,19818,19819,19820,19821,19822,19823,19824,19825,19826,19827,19828,19829,19830,19831,19832,19833,19834,19835,19837,19838,19839,19840,19841,19842,19843,19844,19845,19846,19847,19848,19849,19850,19851,19852,19853,19854,19855,19856,19857,19858,19859,19860,19861,19862,19863,19864,19865,19866,19867,19868,19869,19870,19871,19872,19873,19874,19875,19876,19877,19878,19879,19880,19881,19882,19883,19884,19885,19886,19887,19888,19889,19890,19891,19892,19893,19894,19895,19896,19897,19898,19899,19900,19901,19902,19903,19904,19905,19906,19907,19908,19909,19910,19911,19912,19913,19915,19916,19917,19918,19919,19920,19921,19922,19923,19924,19925,19926,19927,19928,19930,19931,19932,19933,19934,19935,19936,19937,19938,19939,19940,19941,19942,19943,19944,19945,19946,19947,19948,19949,19950,19951,19952,19953,19954,19955,19956,19957,19958,19959,19960,19961,19962,19963,19964,19965,19966,19967,19968,19969,19970,19971,19972,19973,19974,19975,19976,19977,19978,19979,19980,19981,19982,19983,19984,19985,19986,19987,19988,19989,19990,19991,19992,19993,19994,19995,19996,19997,19998,19999,20000,20001,20002,20003,20004,20005,20006,20007,20008,20009,20010,20011,20012,20013,20014,20015,20016,20017,20018,20019,20020,20021,20022,20023,20024,20025,20026,20027,20028,20029,20030,20031,20032,20033,20034,20035,20036,20037,20038,20039,20040,20041,20042,20043,20044,20045,20046,20047,20048,20049,20050,20051,20052,20053,20054,20055,20056,20057,20058,20059,20060,20061,20062,20063,20064,20065,20066,20067,20068,20069,20070,20071,20072,20073,20074,20075,20076,20077,20078,20079,20080,20081,20082,20083,20084,20085,20086,20087,20088,20089,20090,20091,20092,20093,20094,20095,20096,20097,20098,20099,20100,20101,20102,20103,20104,20105,20106,20107,20108,20109,20110,20111,20112,20113,20114,20115,20116,20117,20118,20119,20120,20121,20122,20123,20124,20125,20126,20127,20128,20129,20130,20131,20132,20133,20134,20135,20136,20137,20138,20139,20140,20141,20142,20143,20144,20145,20146,20147,20148,20149,20150,20151,20152,20153,20154,20155,20156,20157,20159,20160,20161,20162,20163,20164,20165,20166,20167,20168,20169,20170,20171,20172,20173,20174,20175,20176,20177,20178,20179,20180,20181,20182,20183,20184,20185,20186,20187,20188,20189,20190,20191,20192,20193,20194,20195,20196,20197,20198,20199,20200,20201,20202,20203,20204,20205,20206,20207,20208,20209,20210,20211,20212,20213,20214,20215,20216,20217,20218,20219,20220,20221,20222,20223,20224,20225,20226,20227,20228,20229,20230,20231,20232,20233,20234,20235,20236,20237,20238,20239,20240,20241,20242,20243,20244,20245,20246,20247,20248,20249,20250,20251,20252,20253,20254,20255,20256,20257,20258,20259,20260,20261,20262,20263,20264,20265,20266,20267,20268,20269,20270,20271,20272,20273,20274,20275,20276,20277,20278,20279,20280,20281,20282,20283,20284,20285,20286,20287,20288,20289,20290,20291,20292]

    disbursal_dates = [Date.new(2012, 06, 01), Date.new(2012, 06, 04), Date.new(2012, 06, 05), Date.new(2012, 06, 06), Date.new(2012, 06, 07), Date.new(2012, 06, 8), Date.new(2012, 06, 9), Date.new(2012, 06, 14), Date.new(2012, 06, 15), Date.new(2012, 06, 16), Date.new(2012, 05, 28), Date.new(2012, 05, 29), Date.new(2012, 05, 30), Date.new(2012, 03, 23), Date.new(2012, 03, 26), Date.new(2012, 03, 27), Date.new(2012, 03, 28), Date.new(2012, 03, 29), Date.new(2012, 03, 30)]

    date = Date.new(2012, 06, 30)

    #following are the various dates on which monthly cash flows is being calculated.
    from_dates = [Date.new(2012, 03, 01), Date.new(2012, 04, 01), Date.new(2012, 05, 01), Date.new(2012, 06, 01), Date.new(2012, 07, 01), Date.new(2012, 8, 01), Date.new(2012, 9, 01), Date.new(2012, 10, 01), Date.new(2012, 11, 01), Date.new(2012, 12, 01), Date.new(2013, 01, 01), Date.new(2013, 02, 01), Date.new(2013, 03, 01), Date.new(2013, 04, 01), Date.new(2013, 05, 01), Date.new(2013, 06, 01), Date.new(2013, 07, 01), Date.new(2013, 8, 01), Date.new(2013, 9, 01), Date.new(2013, 10, 01), Date.new(2013, 11, 01), Date.new(2013, 12, 01), Date.new(2014, 01, 01), Date.new(2014, 02, 01), Date.new(2014, 03, 01), Date.new(2014, 04, 01), Date.new(2014, 05, 01), Date.new(2014, 06, 01), Date.new(2014, 07, 01), Date.new(2014, 8, 01)]

    to_dates = [Date.new(2012, 03, 31), Date.new(2012, 04, 30), Date.new(2012, 05, 31), Date.new(2012, 06, 30), Date.new(2012, 07, 31), Date.new(2012, 8, 31), Date.new(2012, 9, 30), Date.new(2012, 10, 31), Date.new(2012, 11, 30), Date.new(2012, 12, 31), Date.new(2013, 01, 31), Date.new(2013, 02, 28), Date.new(2013, 03, 31), Date.new(2013, 04, 30), Date.new(2013, 05, 31), Date.new(2013, 06, 30), Date.new(2013, 07, 31), Date.new(2013, 8, 31), Date.new(2013, 9, 30), Date.new(2013, 10, 31), Date.new(2013, 11, 30), Date.new(2013, 12, 31), Date.new(2014, 01, 01), Date.new(2014, 02, 28), Date.new(2014, 03, 31), Date.new(2014, 04, 30), Date.new(2014, 05, 31), Date.new(2014, 06, 30), Date.new(2014, 07, 31), Date.new(2014, 8, 31)]

    sl_no = 0

    f = File.open("tmp/mas_financials_#{DateTime.now.to_s}.csv", "w")
    f.puts("\"Sl. No.\", \"Branch Id\", \"Branch Name\", \"Center Id\", \"Center Name\", \"Client Id\", \"Client Name\", \"Date of Birth\", \"Caste\", \"Residence Address\", \"Residence Pin Code\", \"State\", \"Residence Phone Number\", \"Name of Assets\", \"Gross Income\", \"Gender\", \"Name of Marketing Executive\", \"Loan Id\", \"Purpose of Loans\", \"Category of Loanee\", \"Cycle Number\", \"Date of Disbursement\", \"Disbursement Mode\", \"Disbursement Cheque Number\", \"First Installment Date\", \"Last Installment Date\", \"Outstanding Principal\", \"Outstanding Interest\", \"Days Since Disbursal\", \"Scheme IRR (%)\", \"Amount Financed\", \"Upfront Fees Amount in Rs.\", \"Insurance Charges\", \"Any Other Charges\", \"Installment Amount\", \"Tenure in Weeks\", \"Advance EMI\", \"No. Of Installment\", \"EMI Frequency\", \"Seasoning\", \"OD. Inst.\", \"Od. Amt. Rs.\", \"SD Amt. Rs.\", \"SD. Refund / Scheme Refund\", \"Mode of Repayment\", \"KYC Detail\", \"Future Capital O/S Amt. Rs.\", \"Future O/S Installment\", \"Future Receivable Amt. Rs.\", \"Cash Flow in March 2012\", \"Cash Flow in April 2012\", \"Cash Flow in May 2012\", \"Cash Flow in June 2012\", \"Cash Flow in July 2012\", \"Cash Flow in August 2012\", Cash Flow in September 2012, \"Cash Flow in October 2012\", \"Cash Flow in November 2012\", \"Cash Flow in December 2012\", \"Cash Flow in January 2013\", \"Cash Flow in February 2013\", \"Cash Flow in March 2013\", \"Cash Flow in April 2013\", \"Cash Flow in May 2013\", \"Cash Flow in June 2013\", \"Cash Flow in July 2013\", \"Cash Flow in August 2013\", \"Cash Flow in September 2013\", \"Cash Flow in October 2013\", \"Cash Flow in November 2013\", \"Cash Flow in December 2013\", \"Cash Flow in January 2014\", \"Cash Flow in February 2014\", \"Cash Flow in March 2014\", \"Cash Flow in April 2014\", \"Cash Flow in May 2014\", \"Cash Flow in June 2014\", \"Cash Flow in July 2014\", \"Cash Flow in August 2014\"")

    Loan.all(:client_id => client_ids, :disbursal_date => disbursal_dates).each do |loan|

      sl_no += 1

      client = Client.get(loan.client_id)
      client_id = client.id
      client_name = client.name
      client_date_of_birth = client.date_of_birth
      client_caste = client.caste
      client_address = ""
      client_address_pin_code = client.address_pin
      client_state = "Bihar"
      if client.phone_number
        client_phone_number = client.phone_number
      else
        client_phone_number = "Not Specified"
      end
      client_name_of_assets = "NA"
      client_gross_income = client.total_income
      client_gender = client.gender.capitalize
      client_marketing_executive = client.center.manager.name

      center_id = client.center.id
      center_name = client.center.name

      branch_id = client.center.branch.id
      branch_name = client.center.branch.name

      loan_id = loan.id
      loan_cycle_number = loan.cycle_number
      loan_category = "NA"
      loan_purpose = (loan.occupation ? loan.occupation.name : "Not specified")
      loan_disbursal_date = loan.disbursal_date
      if loan.cheque_number.empty?
        loan_disbursement_mode = "Cash"
        loan_disbursement_cheque_number = "NA"
      else
        loan_disbursement_mode = "Cheque"
        loan_disbursement_cheque_number = loan.cheque_number
      end
      loan_first_installment_date = loan.scheduled_first_payment_date
      loan_last_installment_date = loan.loan_history.max(:date, :conditions => ['principal_due_today != ?', 0.0], :conditions => ['interest_due_today != ?', 0.0])
      loan_outstanding_principal = loan.actual_outstanding_principal_on(date)
      loan_outstanding_interest = loan.actual_outstanding_interest_on(date)
      loan_days_since_disbursal = date - loan.disbursal_date
        
      loan_scheme_irr = (loan.irr * 100)
      loan_product_name = loan.loan_product.name
      loan_amount_financed = loan.amount
      loan_upfront_fees = loan.applicable_fees[0].amount
      loan_insurance_charges = loan.applicable_fees[1].amount
      loan_any_other_charges = "NA"
      loan_installment_amount = (loan.scheduled_principal_for_installment(1) + loan.scheduled_interest_for_installment(1))
      loan_tenure = loan.number_of_installments
      loan_advance_emi = ""
      loan_number_of_installments = loan.number_of_installments
      loan_installment_frequency = loan.installment_frequency.to_s.capitalize
      loan_seasoning = "NA"
      loan_overdue_installment = 0
      loan_overdue_amount = 0
      loan_sd_amount = "NA"
      loan_sd_refund = "NA"
      loan_mode_of_repayment = "Cash"
      loan_kyc_details = "Yes"
      loan_future_outstanding_amount = loan.scheduled_outstanding_total_on(date)
      loan_future_outstanding_installment = (loan.number_of_installments - loan.number_of_installments_before(date))
      loan_future_receivable_amount = (loan.total_to_be_received - loan.total_received_up_to(date))

      if (loan.scheduled_first_payment_date >= from_dates[0] and loan.scheduled_first_payment_date <= to_dates[0])
        monthly_cash_flow_march_2012 = (loan.scheduled_principal_for_installment(1) + loan.scheduled_interest_for_installment(1))
      else
        monthly_cash_flow_march_2012 = 0
      end
      monthly_cash_flow_april_2012 = (loan.scheduled_outstanding_total_on(from_dates[1]) - loan.scheduled_outstanding_total_on(to_dates[1]))
      monthly_cash_flow_may_2012 = (loan.scheduled_outstanding_total_on(from_dates[2]) - loan.scheduled_outstanding_total_on(to_dates[2]))
      monthly_cash_flow_june_2012 = (loan.scheduled_outstanding_total_on(from_dates[3]) - loan.scheduled_outstanding_total_on(to_dates[3]))
      monthly_cash_flow_july_2012 = (loan.scheduled_outstanding_total_on(from_dates[4]) - loan.scheduled_outstanding_total_on(to_dates[4]))
      monthly_cash_flow_august_2012 = (loan.scheduled_outstanding_total_on(from_dates[5]) - loan.scheduled_outstanding_total_on(to_dates[5]))
      monthly_cash_flow_september_2012 = (loan.scheduled_outstanding_total_on(from_dates[6]) - loan.scheduled_outstanding_total_on(to_dates[6]))
      monthly_cash_flow_october_2012 = (loan.scheduled_outstanding_total_on(from_dates[7]) - loan.scheduled_outstanding_total_on(to_dates[7]))
      monthly_cash_flow_november_2012 = (loan.scheduled_outstanding_total_on(from_dates[8]) - loan.scheduled_outstanding_total_on(to_dates[8]))
      monthly_cash_flow_december_2012 = (loan.scheduled_outstanding_total_on(from_dates[9]) - loan.scheduled_outstanding_total_on(to_dates[9]))

      monthly_cash_flow_january_2013 = (loan.scheduled_outstanding_total_on(from_dates[10]) - loan.scheduled_outstanding_total_on(to_dates[10]))
      monthly_cash_flow_february_2013 = (loan.scheduled_outstanding_total_on(from_dates[11]) - loan.scheduled_outstanding_total_on(to_dates[11]))
      monthly_cash_flow_march_2013 = (loan.scheduled_outstanding_total_on(from_dates[12]) - loan.scheduled_outstanding_total_on(to_dates[12]))
      monthly_cash_flow_april_2013 = (loan.scheduled_outstanding_total_on(from_dates[13]) - loan.scheduled_outstanding_total_on(to_dates[13]))
      monthly_cash_flow_may_2013 = (loan.scheduled_outstanding_total_on(from_dates[14]) - loan.scheduled_outstanding_total_on(to_dates[14]))
      monthly_cash_flow_june_2013 = (loan.scheduled_outstanding_total_on(from_dates[15]) - loan.scheduled_outstanding_total_on(to_dates[15]))
      monthly_cash_flow_july_2013 = (loan.scheduled_outstanding_total_on(from_dates[16]) - loan.scheduled_outstanding_total_on(to_dates[16]))
      monthly_cash_flow_august_2013 = (loan.scheduled_outstanding_total_on(from_dates[17]) - loan.scheduled_outstanding_total_on(to_dates[17]))
      monthly_cash_flow_september_2013 = (loan.scheduled_outstanding_total_on(from_dates[18]) - loan.scheduled_outstanding_total_on(to_dates[18]))
      monthly_cash_flow_october_2013 = (loan.scheduled_outstanding_total_on(from_dates[19]) - loan.scheduled_outstanding_total_on(to_dates[19]))
      monthly_cash_flow_november_2013 = (loan.scheduled_outstanding_total_on(from_dates[20]) - loan.scheduled_outstanding_total_on(to_dates[20]))
      monthly_cash_flow_december_2013 = (loan.scheduled_outstanding_total_on(from_dates[21]) - loan.scheduled_outstanding_total_on(to_dates[21]))

      monthly_cash_flow_january_2014 = (loan.scheduled_outstanding_total_on(from_dates[22]) - loan.scheduled_outstanding_total_on(to_dates[22]))
      monthly_cash_flow_february_2014 = (loan.scheduled_outstanding_total_on(from_dates[23]) - loan.scheduled_outstanding_total_on(to_dates[23]))
      monthly_cash_flow_march_2014 = (loan.scheduled_outstanding_total_on(from_dates[24]) - loan.scheduled_outstanding_total_on(to_dates[24]))
      monthly_cash_flow_april_2014 = (loan.scheduled_outstanding_total_on(from_dates[25]) - loan.scheduled_outstanding_total_on(to_dates[25]))
      monthly_cash_flow_may_2014 = (loan.scheduled_outstanding_total_on(from_dates[26]) - loan.scheduled_outstanding_total_on(to_dates[26]))
      monthly_cash_flow_june_2014 = (loan.scheduled_outstanding_total_on(from_dates[27]) - loan.scheduled_outstanding_total_on(to_dates[27]))
      monthly_cash_flow_july_2014 = (loan.scheduled_outstanding_total_on(from_dates[28]) - loan.scheduled_outstanding_total_on(to_dates[28]))
      monthly_cash_flow_august_2014 = (loan.scheduled_outstanding_total_on(from_dates[29]) - loan.scheduled_outstanding_total_on(to_dates[29]))
      
      f.puts("#{sl_no}, #{branch_id}, \"#{branch_name}\", #{center_id}, \"#{center_name}\", #{client_id}, \"#{client_name}\", #{client_date_of_birth}, \"#{client_caste}\", \"#{client_address}\", #{client_address_pin_code}, \"#{client_state}\", #{client_phone_number}, \"#{client_name_of_assets}\", #{client_gross_income}, \"#{client_gender}\", \"#{client_marketing_executive}\", #{loan_id}, \"#{loan_purpose}\", \"#{loan_category}\", #{loan_cycle_number}, #{loan_disbursal_date}, \"#{loan_disbursement_mode}\", \"#{loan_disbursement_cheque_number}\", #{loan_first_installment_date}, #{loan_last_installment_date}, #{loan_outstanding_principal}, #{loan_outstanding_interest}, #{loan_days_since_disbursal}, \"#{loan_scheme_irr}\", #{loan_amount_financed}, #{loan_upfront_fees}, #{loan_insurance_charges}, #{loan_any_other_charges}, #{loan_installment_amount}, #{loan_tenure}, #{loan_advance_emi}, #{loan_number_of_installments}, \"#{loan_installment_frequency}\", \"#{loan_seasoning}\", #{loan_overdue_installment}, #{loan_overdue_amount}, \"#{loan_sd_amount}\", \"#{loan_sd_refund}\", \"#{loan_mode_of_repayment}\", \"#{loan_kyc_details}\", #{loan_future_outstanding_amount}, #{loan_future_outstanding_installment}, #{loan_future_receivable_amount}, #{monthly_cash_flow_march_2012}, #{monthly_cash_flow_april_2012}, #{monthly_cash_flow_may_2012}, #{monthly_cash_flow_june_2012}, #{monthly_cash_flow_july_2012}, #{monthly_cash_flow_august_2012}, #{monthly_cash_flow_september_2012}, #{monthly_cash_flow_october_2012}, #{monthly_cash_flow_november_2012}, #{monthly_cash_flow_december_2012}, #{monthly_cash_flow_january_2013}, #{monthly_cash_flow_february_2013}, #{monthly_cash_flow_march_2013}, #{monthly_cash_flow_april_2013}, #{monthly_cash_flow_may_2013}, #{monthly_cash_flow_june_2013}, #{monthly_cash_flow_july_2013}, #{monthly_cash_flow_august_2013}, #{monthly_cash_flow_september_2013}, #{monthly_cash_flow_october_2013}, #{monthly_cash_flow_november_2013}, #{monthly_cash_flow_december_2013}, #{monthly_cash_flow_january_2014}, #{monthly_cash_flow_february_2014}, #{monthly_cash_flow_march_2014}, #{monthly_cash_flow_april_2014}, #{monthly_cash_flow_may_2014}, #{monthly_cash_flow_june_2014}, #{monthly_cash_flow_july_2014}, #{monthly_cash_flow_august_2014}")

    end
    f.close
  end
end
