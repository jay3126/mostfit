- if @insurance_policy and @insurance_policy.id and not @insurance_policy.id.blank?
  = hidden_field :id
%table
  %tr
    %td
      Insurance Product
    %td
      - if defined? :product_fixed? and @insurance_policy.insurance_product
        = link_to @insurance_policy.insurance_product.name, resource(@insurance_policy.insurance_product)
        = hidden_field :insurance_product_id, :value => @insurance_policy.insurance_product.id
      - else
        = select :insurance_product_id, :collection => InsuranceProduct.all, :prompt => "---", :value_method => :id, :text_method => :name
        = link_to 'Add a product', resource(:insurance_products, :new, {:return => (@client ? resource(@client, :insurance_policies, :new) : nil)}), :class => "_remote_"
  %tr
    %td
      Policy Number
    %td
      = text_field :policy_no
  %tr
    %td
      Application number
    %td
      = text_field :application_number
  %tr
    %td
      Sum Insured
    %td
      - if @loan_product and (@loan_product.min_amount == @loan_product.max_amount)
        = @loan_product.min_amount
        = hidden_field :sum_insured, :value => @loan_product.min_amount
      - else
        = text_field :sum_insured
  %tr
    %td
      Premium
    %td
      - if @loan_product.fees
        - if @loan_product.fees(:name.like => "%insurance%", :payable_on => :loan_disbursal_date)
          - premium_amount = @loan_product.fees(:name.like => "%insurance%", :payable_on => :loan_disbursal_date)[0].amount
          = premium_amount
          = hidden_field :premium, :value => premium_amount
        - elsif @loan_product.fees(:name.like => "%premium%", :payable_on => :loan_disbursal_date)
          - premium_amount = @loan_product.fees(:name.like => "%premium%", :payable_on => :loan_disbursal_date)[0].amount
          = premium_amount
          = hidden_field :premium, :value => premium_amount
      - else
        = text_field :premium
        %br
        %span.greytext No premium fees is attached to this loan product. Please enter the same above.
  %tr
    %td
      Date from
    %td
      = date_select_for(@insurance_policy, "date_from", :date => @insurance_policy.date_from)
  %tr
    %td
      Date to
    %td
      = date_select_for(@insurance_policy, "date_to", :date => @insurance_policy.date_to, :max_date => Date.today + 3650)
      = hidden_field :client_id, :value => @client.id
  %tr
    %td
      Status
    %td
      = select(:status, :collection => InsurancePolicy::POLICY_STATUSES.map{|x| [x, x]})
  %tr
    %td
      Cover for
    %td
      = select(:cover_for, :collection => InsurancePolicy::COVER_FOR.map{|x| [x, x]})
  %tr
    %td
      Beneficiary Name
    %td
      = text_field :beneficiary_name
