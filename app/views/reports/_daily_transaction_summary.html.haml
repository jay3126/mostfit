= partial :form
%table.dataTable.report.weeksheet.nojs
  %thead
    %tr
      %th
        Branch
      %th{:colspan => "1"}
        Disbursement
      %th{:colspan => "4"}
        Cash Collection
      %th{:colspan => "3"}
        Cash Foreclosure
      %th{:colspan => "3"}
        Advances
      %th
        Write Offs
    %tr
      %th
      %th
        Amount
      %th
        Principal
      %th
        Interest
      %th
        Fee
      %th
        Total
      %th
        Principal
      %th
        Interest
      %th
        Total
      %th
        Collected
      %th
        Adjusted
      %th
        Balance
      %th
        Amount

  %tbody
    - accumulate_row_values = Hash.new(MoneyManager.default_zero_money)
    - @default_currency ||= MoneyManager.get_default_currency
    - @data.sort_by{|branch| branch}.each do |branch, values|
      %tr
        %td
          %b
            = BizLocation.get(branch).name
        %td
          = values[:loans_disbursed][:total_amount]
          - accumulate_row_values[:loans_disbursed] += values[:loans_disbursed][:total_amount]
        %td
          - payments = values[:loan_allocations].values[0]
          = payments[:principal_received]
          - accumulate_row_values[:principal_received] += payments[:principal_received]
        %td
          = payments[:interest_received]
          - accumulate_row_values[:interest_received] += payments[:interest_received]
        %td
          = values[:fee_receipts][:total_amount]
          - accumulate_row_values[:fee_receipts] += values[:fee_receipts][:total_amount]
        %td
          = payments[:total_received]
          - accumulate_row_values[:total_received] += payments[:total_received]
        %td
          = values[:loan_preclosures][:principal_received]
          - accumulate_row_values[:preclosure_principal_received] += values[:loan_preclosures][:principal_received]
        %td
          = values[:loan_preclosures][:interest_received]
          - accumulate_row_values[:preclosure_interest_received] += values[:loan_preclosures][:interest_received]
        %td
          = values[:loan_preclosures][:total_received]
          - accumulate_row_values[:preclosure_total_received] += values[:loan_preclosures][:total_received]
        %td
          - outstandings = values[:loan_balances].values[0]
          = outstandings[:advance_received_on_date]
          - accumulate_row_values[:advance_received_on_date] += outstandings[:advance_received_on_date]
        %td
          = outstandings[:advance_adjusted_on_date]
          - accumulate_row_values[:advance_adjusted_on_date] += outstandings[:advance_adjusted_on_date]
        %td
          = outstandings[:advance_balance]
          - accumulate_row_values[:advance_balance] += outstandings[:advance_balance]
        %td
          = values[:loan_written_off_values][:total_amount]
          - accumulate_row_values[:loan_written_off_values] += values[:loan_written_off_values][:total_amount]

  - total_rows = Money.add_money_hash_values(@default_currency, accumulate_row_values)
  %tfoot
    %tr
      %th
        Total
      %td
        = total_rows[:loans_disbursed]
      %td
        = total_rows[:principal_received]
      %td
        = total_rows[:interest_received]
      %td
        = total_rows[:fee_receipts]
      %td
        = total_rows[:total_received]
      %td
        = total_rows[:preclosure_principal_received]
      %td
        = total_rows[:preclosure_interest_received]
      %td
        = total_rows[:preclosure_total_received]
      %td
        = total_rows[:advance_received_on_date]
      %td
        = total_rows[:advance_adjusted_on_date]
      %td
        = total_rows[:advance_balance]
      %td
        = total_rows[:loan_written_off_values]