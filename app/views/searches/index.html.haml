%div{:class => "#{@floating ? 'floatingBox' : ''}", :style => "max-width: 80%"}
  - if @floating
    %a.closeButton
      [close]
  - atleast_one = false
  - [["biz_locations", [:name]], ["new_clients", [:name]], ["client_groups", [:name]], ["lendings", [:applied_amount, :lan]], ["staff_members", [:name]], ["bookmarks",[:name]], ["users", [:login]], ['loan_files', [:loan_file_identifier]], ['loan_applications', [:client_reference1_type, :client_reference1, :client_reference2_type, :client_reference2]]].each do |model, functions|
    - objects = instance_variable_get("@#{model}")
    - if objects and count = objects.length and count > 0
      - atleast_one = true
      - last = @floating ? 9 : count-1

      %table
        %tr
          %th{:colspan => 4}
            %h2
              - if model == 'lendings'
                Loans
              - elsif model == 'new_clients'
                Clients
              - else
                = model.camelcase(' ')
        %tr
          %th
            ID
          - functions.each do |function|
            %th
              = function.class==Hash ? function.keys[0] : function
          - objects[0..last].each do |obj|
            %tr
              %td
                = obj.id
              - functions.each do |function|
                %td
                  - field = obj.send(function)
                  - if model.to_sym == :bookmarks
                    - if obj.method==:get
                      - route = YAML::load(obj.route).last
                      = link_to_with_rights obj.name, url(route)
                  - elsif function == :applied_amount
                    - field = Lending.get(params[:query]).to_money[:applied_amount].to_s
                    = link_to_with_rights(field, "/#{model}/#{obj.id}")
                  - elsif model.to_sym == :locations
                    = link_to_with_rights obj.name, url(:controller => :user_locations, :action => "#{obj.location_level.level==0 ? 'weeksheet_collection' : 'show'}", :id => obj.id)
                  - else
                    = link_to_with_rights(field.respond_to?(:name) ? field.name : field, "/#{model}/#{obj.id}")
        - if @floating and count > 10
          %tr
            %td
              %a{:href => "/searches/index?query=#{params[:query]}"}
                more
        - if not @floating and count >= 100
          %tr
            %td{:colspan => 4}
              %i
                Showing 100 #{model.camelcase(' ')}. There are more matching #{model.camelcase(' ')}. 
                %br 
                Please refine your search keyword for relevant results
          
  - unless atleast_one
    %div{:style => "width: 250px"}
      %i
        No results found