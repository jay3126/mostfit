:javascript
  $('table.new_loan').dataTable({
      "bPaginate": false,
      "bJQueryUI": true
    });
- if lendings.blank?
  %h3
    No loan exists
- else
  = form_for(:lendings, :action => url(:controller => :lendings, :action => :update_lending_new_to_approve)) do
    %table.report.weeksheet.nojs.new_loan
      %thead
        %tr
          %th
          %th
            id
          %th
            Applied Amount
          %th
            Borrower
          %th
            Applied Date
          %th
            First Repayment Date
          %th
            Scheduled Disbursal Date
          %th
            Repayment Frequency
          %th
            Tenure
          %th
            Administered At
          %th
            Accounted At
          %th
            Status
          %th
            Created Date
          %th
            Approve
          %th
            Approve Date
          %th
            Approve By Staff
          %th
            Approve Amount
      - loan_row_count = 1
      - lendings.each do |lending|
        %tr
          %td
            = loan_row_count
          %td
            = link_to_with_rights lending.id, resource(lending)
          %td
            = lending.to_money[:applied_amount].to_s
          %td
            = link_to lending.loan_borrower.counterparty.name, url(:controller => :new_clients, :action => :show, :id => lending.loan_borrower.counterparty.id)
          %td
            = lending.applied_on_date
          %td
            = lending.scheduled_first_repayment_date
          %td
            = lending.scheduled_disbursal_date
          %td
            = lending.repayment_frequency
          %td
            = lending.tenure
          %td
            = link_to_with_rights lending.administered_at_origin_location.name, url(:controller => :user_locations, :action => :weeksheet_collection, :id => lending.administered_at_origin)
          %td
            = link_to_with_rights lending.accounted_at_origin_location.name, url(:controller => :user_locations, :action => :show, :id => lending.accounted_at_origin)
          %td
            = lending.status
          %td
            = lending.created_at.strftime('%Y-%m-%d')
          %td
            = check_box :name => "lending[#{lending.id}][]" ,:value => lending.id
          %td
            = date_select "lending[#{lending.id}][][approved_on_date]", lending.applied_on_date, {:id => "lending_#{lending.id}", :size=> "10", :min_date => lending.applied_on_date, :max_date => lending.scheduled_disbursal_date}
          %td
            = select :name => "lending[#{lending.id}][][approved_by_staff]", :collection => StaffMember.all(:id.not => lending.applied_by_staff).collect{|staff| [staff.id, staff.name]}
          %td
            = text_field :name => "lending[#{lending.id}][][approved_amount]", :value => lending.to_money[:applied_amount].to_s.delete('a-z A-Z'), :style => "width:100px;"
          - loan_row_count = loan_row_count + 1
      %tfoot
        %tr.org_total
          %td{:colspan => 17}
    = submit "Approve"
    = submit "Reject"
