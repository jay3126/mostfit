- center_cycle_number = loan_applications_facade.get_current_center_cycle_number(@loan_file.at_center_id)
- branch = BizLocation.get(@loan_file.at_branch_id)
- center = BizLocation.get(@loan_file.at_center_id)
%h1
  = "Loan File #{@loan_file.loan_file_identifier}"
.menu-strip{:style => "width:100%;"}
  %h3
    = "Branch: #{branch.name}"
    %br
    = "Center: #{center.name}"
    %br
    = "Center Cycle Number: #{center_cycle_number}"
    %br
    - healthcheck_is_clear = Checklist.is_healthcheck_complete?(@loan_file.loan_file_identifier.to_s)
    == Healthcheck status: #{Checklist.get_hc_result_status('LoanFile', @loan_file.loan_file_identifier.to_s)}
    %br
    = link_to 'HealthCheck', url_for_checklist('HealthCheck on Loan Files',@loan_file.class.to_s, @loan_file, branch, center, session.user.staff_member, get_effective_date, params, @loan_file.loan_applications.count), :class => 'add grey_button'
    %br
    - if healthcheck_is_clear
      = link_to_with_rights "Client and Loan Creation", url(:controller => :new_clients, :action => :create_clients_for_loan_file, :loan_file_id => @loan_file.id), :class => 'add grey_button'
    - else
      %h3
        %i Client and Loan creation can only be performed after Heathcheck Clear
    %br

.shaded
  %h2 Loan Applications
  - unless @loan_file.loan_applications.blank?
    %table.dataTable.form{:style => "width:100%;"}
      %thead
        %tr
          %th
            = "ID"
          %th
            = "Name"
          %th
            = "Guarantor Name"
          %th
            = "DOB"
          %th
            = "Age"
          %th
            = "Age As On"
          %th
            = "Ration Card No."
          %th
            = "Voter Card No."
          %th
            = "Amount"
          %th
            = "Address"
          %th
            = "State"
          %th
            = "Pincode"
          %th
            = "Status"
      %tbody
        - @loan_file.loan_applications.each do |lap|
          - if (lap.status == Constants::Status::LOAN_FILE_GENERATED_STATUS || lap.status == Constants::Status::CLIENT_CREATED)
            %tr
              %td
                = link_to_with_rights lap.id, "/loan_applications/#{lap.id}"
              %td
                = lap.client_name
              %td
                = lap.client_guarantor_name
              %td
                = lap.client_dob.blank? ? "-" : "#{lap.client_dob}"
              %td
                = lap.client_age_as_on.blank? ? lap.client_age : lap.client_age_as_on
              %td
                = lap.client_age_as_on_date.blank? ? Date.today : lap.client_age_as_on_date
              %td
                = lap.client_reference1
              %td
                = lap.client_reference2
              %td
                = lap.loan_money_amount.to_s
              %td
                = lap.client_address
              %td
                = lap.client_state.humanize
              %td
                = lap.client_pincode
              %td
                = (lap.status == Constants::Status::LOAN_FILE_GENERATED_STATUS && !lap.client_id.blank?) ? "Client created (Existing client)" : lap.status.humanize rescue nil
  - else
    %h3 No loan applications